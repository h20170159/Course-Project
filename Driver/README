This is the kernel-side code
